![](https://i.imgur.com/NEVwXnd.png)

# Twitch TTS Bot (Simple Mode) - Documentation

## Table of Contents
1. [Introduction](#introduction)
2. [Features](#features)
3. [System Requirements and Installation](#system-requirements-and-installation)
   - [Python](#python)
   - [Libraries (pip)](#libraries-pip)
4. [Running the Program](#running-the-program)
5. [User Interface (GUI)](#user-interface-gui)
   - [Connection Section](#connection-section)
   - [TTS Settings Section](#tts-settings-section)
   - [Mode Information](#mode-information)
   - [Chat Section](#chat-section)
   - [Status Bar](#status-bar)
6. [How Does TTS Work on Stream?](#how-does-tts-work-on-stream)
7. [Voice Selection](#voice-selection)
8. [Saving Settings](#saving-settings)
9. [Code Structure (General Overview)](#code-structure-general-overview)
   - [Main Modules](#main-modules)
   - [Class `TwitchTTSBot`](#class-twitchttsbot)
10. [Troubleshooting](#troubleshooting)
11. [Possible Extensions](#possible-extensions)

---

## 1. Introduction

**Twitch TTS Bot (Simple Mode)** is a Python application that connects to Twitch chat and reads messages aloud using Text-To-Speech (TTS) synthesis. It's designed with simplicity in mind: TTS is played on the streamer's default audio device, allowing viewers to hear it if the streamer captures desktop audio in their streaming software (e.g., OBS Studio, Streamlabs).

This mode eliminates the need to configure virtual audio cables (e.g., Virtual Audio Cable).

## 2. Features

- **Twitch chat connection:** Connects to a selected Twitch channel as an anonymous user.
- **Message reading:** Processes chat messages and reads them aloud.
- **TTS engine and voice selection:**
  - Support for system TTS voices through `pyttsx3`.
  - Support for high-quality Microsoft Neural voices (e.g., Zofia, Marek) through `edge-tts`.
  - Optional support for Google voices through `gTTS`.
- **TTS configuration:** Ability to adjust speech speed and TTS volume.
- **Reading nicknames:** Option to enable/disable reading the username before the message.
- **Graphical interface (GUI):** Simple and intuitive interface based on `tkinter` for managing connection and settings.
- **Chat display:** Built-in chat window showing incoming messages.
- **Test mode:** Ability to type your own text and test TTS functionality.
- **Settings saving:** User settings (channel, voice, speed, volume) are saved in `tts_settings_simple.json` file and automatically loaded on restart.
- **Message cleaning:** Removes links and Twitch emotes before passing text to the TTS engine.

## 3. System Requirements and Installation

### Python
- Python 3.8 or newer.

### Libraries (pip)
To make the program work correctly, you need to install the following Python libraries using `pip`. Open terminal or command prompt and execute:

**Required basic:**
```bash
pip install pyttsx3
```

**Recommended for better voices and playback (highly recommended):**
```bash
pip install edge-tts pygame
```

- `edge-tts`: For high-quality Microsoft Neural voices.
- `pygame`: Used for playing audio files generated by edge-tts and gTTS.

**Optional (if you want to use Google voices):**
```bash
pip install gTTS
```

**Full installation of recommended and optional libraries:**
```bash
pip install pyttsx3 edge-tts pygame gTTS
```

## 4. Running the Program

1. Make sure you have Python and all required libraries installed (see Installation section).
2. Save the program code as a `.py` file (e.g., `twitch_tts.py`).
3. Open terminal or command prompt in the folder where you saved the file.
4. Run the program with the command:

```bash
python twitch_tts.py
```

or (if using a specific Python version or Python Launcher on Windows):

```bash
py twitch_tts.py
```

or e.g.:

```bash
python3.11 twitch_tts.py
```

## 5. User Interface (GUI)

After running the program, the main application window will appear with several sections:

### Connection Section

- **Twitch Channel:** Text field where you should enter the name of the Twitch channel you want to connect to (e.g., `your_channel_name`).
- **Connect/Disconnect:** Button for establishing and terminating connection to Twitch chat.
- **Clear Chat:** Button to clear the contents of the chat window in the application.

### TTS Settings Section

- **Voice:** Dropdown list (Combobox) allowing you to select available TTS voice. Voices are retrieved from system (pyttsx3), Microsoft (edge-tts) and optionally Google (gTTS).
- **Speech Speed:** Slider to adjust the speed at which messages are read.
- **TTS Volume:** Slider to adjust the volume of the speech synthesizer. This volume will be audible to both the streamer and (indirectly) to viewers.
- **Read Usernames:** Checkbox deciding whether the username of the sender should be read before each message (e.g., "User123 says: Hello!").
- **Test Voice:** Button to play a sample phrase with the selected voice and settings.
- **Test Mode (type message):** Button that, when clicked, displays an additional field below the chat window. It allows typing your own text which will be processed by TTS after pressing "Speak" or Enter.

### Mode Information

This section displays constant information reminding that TTS is played on the default audio device and for it to be audible on stream, streaming software must capture desktop audio.

### Chat Section

- **Chat Window:** Large text field (ScrolledText) where incoming messages from Twitch chat are displayed.
- **Test Field (hidden by default):** After clicking "Test Mode", a field for entering text and a "Speak" button for testing TTS appears below the chat window.

### Status Bar

At the bottom of the window there's a status bar that displays the current connection state (e.g., "Not connected", "Connected to #channel", "Connection error").

## 6. How Does TTS Work on Stream?

In this "Simple Mode":

1. The Twitch TTS Bot application plays speech synthesizer audio on your computer's default audio output device (e.g., on headphones or speakers you're using).
2. You (the streamer) hear the TTS directly from this device.
3. Your streaming software (e.g., OBS Studio, Streamlabs) must be configured to capture desktop audio (often called "Desktop Audio" or "System Audio").
4. Since TTS is part of desktop audio, viewers will also hear it along with other sounds from your computer (e.g., game audio, music).

**Advantages:**
- Simple setup, doesn't require additional software (like Virtual Audio Cable).

**Disadvantages:**
- No ability to independently adjust TTS volume for viewers from the bot application (viewer volume depends on TTS volume in the bot and desktop audio source settings in OBS).
- TTS is mixed with other desktop sounds.

## 7. Voice Selection

The program automatically detects available voices:

- **System (pyttsx3):** Voices installed in your operating system. Their quality and availability (including Polish ones) may vary.
- **Microsoft Neural (edge-tts):** High-quality voices, including very good Polish ones (Zofia, Marek, Agnieszka). Recommended for best quality. Require installed `edge-tts` and `pygame` libraries.
- **Google (gTTS):** Google voices. Require installed `gTTS` and `pygame` libraries.

Voices can be selected from the dropdown list in the "TTS Settings" section.

## 8. Saving Settings

After changing settings (such as selected channel, voice, speech speed, volume) and successful connection to the channel, settings are automatically saved to the `tts_settings_simple.json` file in the same folder as the program. On the next program startup, these settings will be automatically loaded.

## 9. Code Structure (General Overview)

### Main Modules

The program uses standard Python modules and external libraries:

- `socket`: For network communication with Twitch IRC server.
- `threading`: For handling network operations and TTS in separate threads to avoid blocking the GUI.
- `time`: For handling delays.
- `pyttsx3`, `edge_tts`, `gTTS`: Speech synthesis engines.
- `pygame`: For playing audio files generated by edge-tts and gTTS.
- `re`: For regular expressions (e.g., message cleaning).
- `queue`: For safe message passing between threads (TTS queue).
- `tkinter`: For creating the graphical interface.
- `json`: For saving and loading settings.
- `os`: For file system operations (e.g., checking settings file existence).
- `sys`: For interacting with the Python interpreter.
- `asyncio`: Used internally by edge-tts.

### Class `TwitchTTSBot`

The main program logic is enclosed in the `TwitchTTSBot` class. Most important methods:

- `__init__(self)`: Constructor, initializes variables, TTS engines, GUI, loads settings.
- `setup_tts(self)`: Configures available voices.
- `setup_gui(self)`: Creates all graphical interface elements.
- `connect_to_twitch(self)`: Establishes connection to Twitch IRC server.
- `listen_to_chat(self)`: Thread listening to chat messages.
- `add_to_chat(self, username, message)`: Adds message to GUI and TTS queue.
- `_process_tts_text(self, text)`: Selects appropriate TTS engine and reads text.
- `tts_worker(self)`: Thread processing queue of messages to read.
- `speak_with_pyttsx3(self, text)`, `speak_with_edge_tts(self, text, voice_id)`, `speak_with_gtts(self, text)`: Methods specific to each TTS engine.
- `play_audio_file_pygame(self, audio_file, volume, is_temp_file)`: Plays audio file using pygame.
- `save_settings(self)`, `load_settings(self)`, `apply_settings(self)`: Settings management.
- GUI event handling methods (e.g., button clicks, slider value changes).
- `run(self)`: Runs the main tkinter application loop.
- `on_closing(self)`: Handles application window closing.

## 10. Troubleshooting

**ModuleNotFoundError:** Indicates missing required library. Install it using `pip install <library_name>`.

**No Polish voices / low voice quality:**
- Make sure you have `edge-tts` and `pygame` installed.
- Select a voice with "(Microsoft Neural)" notation from the voice list (e.g., Zofia, Marek).
- Check if Polish language packs and system voices are installed in your system.

**TTS not working / no sound:**
- Check if TTS volume in the application is not set to 0.
- Make sure the default audio device in the system works properly and is not muted.
- If using edge-tts or gTTS, check if pygame.mixer initializes correctly (console messages at program startup can help). pygame.mixer initialization errors often indicate problems with SDL configuration or audio drivers.
- Check error messages in the console from which you ran the program.

**Program doesn't connect to Twitch:**
- Check the correctness of the Twitch channel name.
- Make sure you have internet connection.
- Check if firewall is not blocking the connection.

**AttributeError: type object 'Queue' has no attribute 'Empty':** Make sure the Empty exception is correctly imported from the queue module (`from queue import Queue, Empty as QueueEmpty`) and used in try-except blocks (`except QueueEmpty:`).

**DeprecationWarning: There is no current event loop (asyncio):** Usually not a critical error, but indicates older way of using `asyncio.get_event_loop()`. The code tries to handle this.

## 11. Possible Extensions

- Adding OAuth token support for logging in as a specific user (would enable e.g., sending messages through the bot).
- Message filtering (e.g., blocking specific words, ignoring bot commands).
- TTS queuing with priorities (e.g., for subscribers).
- Integration with Twitch channel points system.
- More advanced message cleaning options (e.g., removing character repetitions).
- Reintroducing "Advanced Mode" with Virtual Audio Cable support for more precise audio control.
